<link href="~/css_new/jquery.range.css" rel="stylesheet" />
<div class="modal fade" id="sharingModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">Share Report</h4>
                <small class="font-bold">Select Report Options</small>
            </div>
            <div class="modal-body content animate-panel">
                <form method="get" class="form-horizontal" id="frmShareHealthHistory">
                    <label>Select the information to include in your report:</label>
                    <div><a href="javascript:void(0);" style="color:limegreen;text-decoration:underline">Select all</a>|<a href="javascript:void(0);" style="color:limegreen;text-decoration:underline">Deselect all</a></div>
                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" checked="checked" disabled="disabled" value="1" id="inlineCheckbox1"> Personal Information
                            </label>
                        </div>
                        @*<div class="col-sm-4">
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="2" id="inlineCheckbox2"> Emergency Information
                                </label>
                            </div>
                            <div class="col-sm-4">
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="3" id="inlineCheckbox3"> Employer Information
                                </label>
                            </div>*@
                    </div>



                    @*<div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-4">
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="4" id="inlineCheckbox4"> Insurance Information
                                </label>
                            </div>
                            <div class="col-sm-4">
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="5" id="inlineCheckbox5"> Legal Information
                                </label>
                            </div>
                            <div class="col-sm-4">
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="6" id="inlineCheckbox6"> Preferences and Special Needs
                                </label>
                            </div>
                        </div>*@


                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="7" id="inlineCheckbox7"> Allergies
                            </label>
                        </div>
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="8" id="inlineCheckbox8"> Immunizations
                            </label>
                        </div>
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="9" id="inlineCheckbox9"> Medications
                            </label>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="10" id="inlineCheckbox10"> Procedures
                            </label>
                        </div>
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="11" id="inlineCheckbox11"> Labs/Tests
                            </label>
                        </div>
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="12" id="inlineCheckbox12"> Problems
                            </label>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="13" id="inlineCheckbox13"> Wellness - Activities
                            </label>
                        </div>
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="14" id="inlineCheckbox14"> Wellness - Blood Pressure
                            </label>
                        </div>
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="15" id="inlineCheckbox15"> Wellness - Blood Glucose
                            </label>
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <div class="col-sm-4">
                            <label class="checkbox-inline">
                                <input type="checkbox" value="16" id="inlineCheckbox16"> Wellness - BMI
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <form class="form-horizontal" id="frmShare">
                    <div class="form-group">

                        <label class="col-sm-4">Ask Query <span class="text-danger"> *</span></label>
                        <div class="col-sm-8" id="divAsk">
                            <textarea class="form-control" rows="2" id="Query" name="Query" datacolumn="Query"></textarea>
                        </div>
                    </div>

                    <div class="form-group">

                        <label class="col-sm-4">Share With <span class="text-danger"> *</span></label>
                        <div class="col-sm-7" id="divDoc">
                            <select onchange="onContactChange(this)" class="form-control " data-val="true" data-val-required="The Contact Type field is required." id="DoctorName" name="DoctorName"  datacolumn ="DoctorName" style="width: 300px;"></select>
                        </div>
                        <a href="/MedicalContactRecords/Index" class="col-sm-1">
                            <i class="fa fa-user-plus fa-2x" data-toggle="tooltip" title="Add Doctor here" data-placement="left" align="center"></i>
                        </a>

                    </div>

                    @*<div class="form-group">
                            <label class="col-sm-4">Email</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="EmailAddress" name="EmailAddress" type="hidden" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4">Phone Number</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="PhoneNumber" name="PhoneNumber" type="hidden" />
                            </div>
                        </div>*@
                    <div class="form-group">
                        <label class="col-sm-4">Valid Upto (Days)</label>
                        <div class="col-sm-8">
                            <input class="form-control" id="PhoneNumber" name="PhoneNumber" type="hidden" />
                            <input class="form-control" id="EmailAddress" name="EmailAddress" type="hidden" />
                            <div class="demo-output">

                                <input class="single-slider" type="hidden" value="1" name="ValidUpto" id="ValidUpto" />
                            </div>
                        </div>
                    </div>


                </form>
                <div>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    @*<button type="button" class="btn btn-primary">View Report</button>*@
                    <a href="javascript:void(0);" class="btn btn-primary" onclick="SaveHealthHistory();">Share Report</a>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    #ex1Slider .slider-selection {
        background: #BABABA;
    }
    #divAsk .error{
      margin :1% 65% 0 0!important;
    
    }
     #divDoc .error{
      margin :1% 47% 0 0!important;
      width:55%;
    }
</style>

<script src="@Url.Content("~/js/jquery.validate.js")"></script>
<script src="@Url.Content("~/js/jquery.validate.unobtrusive.js")"></script>
@*<script src="~/vendor/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.min.js"></script>*@
<script src="~/js/jquery.range.js"></script>
<script>



    $("#frmShare").validate({
        rules:
        {
            EmailAddress:
            {
                required: true
            },
            PhoneNumber:
          {
              required: true
          },

            DoctorName:
                {
                    required: true,

                },
            Query:
                {
                    required: true,

                },


        },
        messages: {
            EmailAddress: {
                required: "Email Address is required"
            },
            PhoneNumber: {
                required: "Phone Number is required"
            },
            Query: {
                required: "Query is required"
            },
            DoctorName:{
                required: "Doctor Name is required"

            },

        },
        submitHandler: function (form) {
            form.submit();
        }
        //errorPlacement: function (error, element) {
        //    element.css("text-align", "left");
        //}
    });
    function SharingCalled() {
        $("#Query").val("");
        $("#DoctorName")[0].selectedIndex = -1;
        GetDoctorsList();
        $('#sharingModal').modal('toggle');
        $('#ValidUpto').jRange({
            from: 1.0,
            to: 5.0,
            step: 1,
            scale: [1.0,2.0, 3.0, 4.0, 5.0],
            format: '%s',
            width: 300,
            showLabels: true,
            snap: true,
            isRange: false,

        });
    }


    function onContactChange(Object) {

        $("#EmailAddress").val($(Object).val().split("_")[1]);
        $("#PhoneNumber").val($(Object).val().split("_")[0]);

    }
    function GetDoctorsList() {

        $.ajax({
            type: "Get",
            contentType: "application/json; charset=utf-8",
            url: ROOT + "Common/GetDoctorsList",

            dataType: "json",
            success: function (data) {
                $("#DoctorName").empty();
                $("#DoctorName").append('<option  value="">- Select Doctor</option>')
                $.each(data, function (p, ui) {
                    var Value = ui.PrimaryPhone + "_" + ui.EmailAddress;

                    $("#DoctorName").append('<option  value=' + Value + '>' + ui.ContactName + '</option>')
                    //   $("p[datacolumn='" + p + "']", "#frmShowContact").text(ui);
                });
            },
            error: function (result) {
                alert(result);
            }
        });

    }
    function SaveHealthHistory() {
        if ($("#frmShare").valid()) {
            var str = "";
            var del = "";
            $("input[type='checkbox']", "#frmShareHealthHistory").each(function (idx, ui) {
                if ($(this).is(':checked')) {
                    str = str + del + $(this).val();
                    del = ",";
                }
            });

            $('#sharingModal').modal('toggle');
            $.ajax({
                type: "Post",
                contentType: "application/json; charset=utf-8",
                url: ROOT + "Common/SendHealthReport",
                //    data: '{"strModules" : "' + str + '",    "EmailAddress" : "' + $("#EmailAddress").val() + '", "PhoneNumber" :"' + $("#PhoneNumber").val() + '"}',
                data: JSON.stringify({ strChecks: str, EmailAddress: $("#EmailAddress").val(), PhoneNumber: $("#PhoneNumber").val(), ValidUpto: $("#ValidUpto").val(), Query: $("#Query").val() }),

                // data: JSON.stringify(str),
                dataType: "json",
                success: function (data) {
                    var docId = document.getElementById("DoctorName");
                    var docName = docId.options[docId.selectedIndex].text;
                    swal({
                        title: "Health Detail Shared With Dr." + docName,
                        text: "",
                        type: "success"
                    });
                },
                error: function (result) {
                    alert(result);
                }
            });
        }
    }


</script>
@{
    Layout = "~/Views/Shared/_Layout_Blank.cshtml";
    ViewBag.Title = "Register";
}
@using PHRMS.ViewModels
@model PHRMS.ViewModels.RegistrationViewModel

<style type="text/css">
    .phrmsrimg {
        margin-top: -60px;
        margin-left: 45px;
    }

    .bgsignup_phrms {
        background-color: #337AB7;
        color: #FFF;
    }

    .headerhght {
        height: 60px;
    }

    .hdrshadow {
        box-shadow: 0 1px 5px #ccc;
    }

    .hdrbgclr {
        background-color: #fff;
    }

    .hdrnavcustom {
        background-color: #fff;
        margin-top: -20px;
        margin-right: -43px;
        float: right;
    }
</style>
<link href="~/content/landing.css" rel="stylesheet" />
<link href="~/vendor/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/content/style_new.css" rel="stylesheet" />
<div class="no-padding headerhght">
    <nav class="navbar navbar-default navbar-fixed-top hdrshadow">
        <div class="container-fluid no-padding hdrbgclr">
            <div class="col-md-12 col-sm-12 headerhght">
                <div class="col-md-6 col-sm-6 zeropadmbl">
                    @*<img src="~/images/nationalemblemindia.png" class="img-responsive lionimg" width="42">*@
                    <img src="~/images/myHealthRecordlogo.png" class="img-responsive " width="42" />
                    <a href="~/Home/Index">
                        <img src="~/images/MyHealthRecord.png" class="img-responsive phrmsrimg" />
                    </a>
                </div>
               <div class="col-md-6 col-sm-6 righthalf">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="navbar-header hdrnavcustom">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
                        </div>
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav"></ul>
                            <ul class="nav navbar-nav navbar-right tabcntr btnsintab" style="display: flex">
                             <li class="lirghtup lipad">
                                    <img src="~/images/nationalemblemindia.png" class="img-responsive lionimg" width="42">
                                </li>
                                <li class="lirghtup lipad">
                                    <img src="~/images/digital_india_logo.png" class="img-responsive hdrmobile dgindiafullimg" width="102">
                                </li>
                                <li class="">
                                    <a href="~/Home/Login">
                                        <button class="btn btn-success btn-xs">Sign In</button>
                                    </a>
                                </li>
                                <li class="">
                                    <a href="~/Account/Register">
                                        <button class="btn btn-primary btn-xs">Sign Up</button>
                                    </a>
                                </li>
                                <li class="">
                                    <a href="">
                                        <button class="btn btn-warning btn-xs">Doctor Login</button>
                                    </a>
                                </li>
                             </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</div>
<br />
<div class="register-container">
    <div class="row">
        <div class="col-md-12">
            <div class="text-center m-b-md">
                <h3>Registration</h3>
                @*<small>Full suported AngularJS WebApp/Admin template with very clean and aesthetic style prepared for your next app. </small>*@
            </div>
            <div class="hpanel">
                <div class="panel-body">
                    @if (Model == null || Model.status.Equals(PHRMS.ViewModels.RegProcessCode.Initial))
                    {
                        @Html.Partial("_NewReg")
                    }
                    else
                    {
                        @Html.Partial("_OTPVerify")
                    }
                </div>
            </div>
        </div>
    
    </div>
</div>
<br /><br /><br />
<div class="col-md-12 col-sm-12 col-xs-12 bgsignup_phrms">
    <div class="col-md-9 col-sm-10 col-xs-10 bgsignup_phrms">
        &nbsp;
    </div>
    <div class="col-md-3 col-sm-2 col-xs-2 bgsignup_phrms">
        @*<img src="~/images/zeroone.jpg" class="img-responsive" alt="zeroone">*@
    </div>
</div>
<div class="col-md-12 col-sm-12 col-xs-12 bgfooter">
    <div class="container">

        <div class="col-md-6 col-sm-6 ftrgap">
            <div class="row">
                <div class="titlefooter"><strong></strong></div>

                <ul class="ftrlists">
                    <li>&nbsp;<a class="whitetext" href="http://cdac.in/index.aspx?id=about" target="_blank">About</a> | </li>
                    @*<li>&nbsp;<a class="whitetext" href="#">Statistics</a> | </li>*@
                    <li>&nbsp;<a class="whitetext" href="~/Account/FAQS" target="_blank">FAQs</a> | </li>
                    @*<li>&nbsp;<a class="whitetext" href="#">Resource Center</a> | </li>*@
                    <!--<li>&nbsp;<a class="whitetext" href="/news.php">/*News</a> | </li> -->
                    <li>&nbsp;<a class="whitetext" href="~/Account/ContactUs" target="_blank">Contact us</a></li>
                </ul>

                <div class="securityfoot">
                    <ul class="ftrlists">
                        <!-- <li>&nbsp;<a href="#" target="popup"><img src="files/getseal.png" width="80px"></a> &nbsp; </li>
                        <li>&nbsp;<img src="files/256sll.png" width="90px">&nbsp; </li>-->
                        <li>Content Owned, Updated and Maintained by C-DAC Mohali</li>
                    </ul>
                    @*<ul class="ftrlists">
                        <li> by C-DAC Mohali</li>
                    </ul>*@
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-6 ftrgap">
            <div class="row">
                <div class="col-sm-10">
                    <p style="color: #CCC; text-align: right; margin-top: 15px;">
                        Centre For Development of Advanced Computing
                        <br />
                        A Scientific Society of the Ministry of Electronics &amp; Information Technology, Government of India.<br />
                        Copyright 2017 MyHealthRecord. All Rights Reserved
                    </p>
                </div>
                <div class="col-md-2">
                    <p style="vertical-align: middle; margin-top: 25px;">
                        <img src="~/images/whitetranscdac.png" class="img-responsive pull-right" width="100">
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .titlefooter {
        color: #D9D8D8;
        font-size: 17px;
        margin-bottom: 14px;
        margin-left: 10px;
        margin-top: 5px;
    }

    /* Validation */
    .form-control.error {
        border-color: #e74c3c !important;
    }

    label.error,
    label span.error {
        color: #e74c3c;
        margin: 5px 0 0 0;
        font-weight: 400;
    }

    label span.error {
        margin-left: 5px;
    }

    label.error:before {
        content: "\f071";
        font-family: 'FontAwesome';
        margin: 0 4px;
    }

    /*Validation Custom*/

    .input-validation-error {
        border-color: #e74c3c !important;
    }

    span.field-validation-error {
        margin-left: 5px;
        color: #e74c3c;
        margin: 5px 0 0 0;
        font-weight: 400;
    }

        span.field-validation-error:before {
            content: "\f071";
            font-family: 'FontAwesome';
            margin: 0 4px;
        }
</style>


@*<link href="~/vendor/toastr/build/toastr.min.css" rel="stylesheet" />*@
<link href="~/vendor/sweetalert/lib/sweet-alert.css" rel="stylesheet" />
<script src="~/vendor/sweetalert/lib/sweet-alert.min.js"></script>
@*<script src="~/vendor/toastr/build/toastr.min.js"></script>*@
@if (Model != null && Model.status.Equals(PHRMS.ViewModels.RegProcessCode.OtpVerification))
{

    <script type="text/javascript">
        var smscode = "";
        var mobileNum = "";
        var emailID = "";
        var ROOT = "@Url.Content("~/")";
        submit_flag = false;
        $(document).ready(function () {
            smscode = "@Model.OTP";
            mobileNum = "@Model.MobileNo";
            emailID = "@Model.Email";
            //alert(smscode);
            $("#VerifyOTPForm").validate({
                rules:
                {
                    OTP:
                    {
                        required: true,
                        maxlength: 6,
                        minlength: 6,
                        number: true,
                        validOTP: smscode
                    }
                },
                messages: {
                    OTP: {
                        validOTP: "Verification code doesn't matched. Click below link to receive verification code again.",
                        number: "Verification code contains only digits."
                    }
                },
                submitHandler: function (form) {
                    form.submit();
                }
            });

            var myEvent = window.attachEvent || window.addEventListener;
            var chkevent = window.attachEvent ? 'onbeforeunload' : 'beforeunload'; /// make IE7, IE8 compatable

            myEvent(chkevent, function (e) { // For >=IE7, Chrome, Firefox
                if(!submit_flag) {
                    var confirmationMessage = 'This page is asking you to confirm that you want to leave – All progress will be lost.';  // a space
                    (e || window.event).returnValue = confirmationMessage;
                    return confirmationMessage;
                }
            });

            $('.btn-success').click(function() {
                submit_flag = true;
                //$('.splash').fadeIn();
                $(this).closest("form").submit();
            });

            $("#resendOTP").click(function () {
                ResendOTP();
            });

            $.validator.addMethod("validOTP",
    function (value, element, param) {
        return value == param;
    });

            //toastr.options = {
            //    "debug": false,
            //    "newestOnTop": false,
            //    "positionClass": "toast-top-center",
            //    "closeButton": true,
            //    "debug": false,
            //    "toastClass": "animated fadeInDown",
            //};
        });

        function ResendOTP() {
            var info = {strMobileNo :mobileNum,strEmailId:emailID};
            $.ajax({
                type: "Post",
                contentType: "application/json; charset=utf-8",
                url: ROOT + "Account/ResendVerificationCode",
                data: JSON.stringify(info),
                dataType: "json",
                success: function (data) {
                    //var res = $.parseJSON(data);
                    //alert(res[0]);
                    //alert(res[0].res);
                    //alert(data["res"]);
                    if (data["res"] === true) {
                        swal({
                            title: "Code Re-Sent!",
                            text: "Verification code has been re-sent on your registered email-id and mobile no."
                        });

                        //toastr.success('Newly generated verification code has been sent on your mobile!');
                        $('input[name="OTP"]').rules('add', {
                            validOTP: data["code"]
                        });
                    }
                    else
                    {

                        swal({
                            title: "Oops!",
                            text: "Failed to send Verification Code!",
                            type: "error"
                        });
                    }
                },
                error: function (result) {

                }
            });
        }

        $(document)
    .ajaxStart(function () {
        $('.splash').fadeIn();
    })
    .ajaxStop(function () {
        $('.splash').fadeOut();
    });

        $("form").submit(function () {
            if ($(this).valid()) {
                $('.splash').fadeIn();
            }
        });
    </script>
}
else if (Model != null && Model.status != PHRMS.ViewModels.RegProcessCode.Initial)
{
    <script>
        var ROOT = "@Url.Content("~/")";
        $(document).ready(function () {
            var code = @Model.status;
            if (code == (@PHRMS.ViewModels.RegProcessCode.Success)) {
                setTimeout(function () {
                    swal({
                        title: "Success!",
                        text: "You have been registered successfully with MyHealthRecord!",
                        type: "success"
                    },
                                function () {
                                    $('.splash').fadeIn();
                                    window.location = ROOT + 'Home/Index';
                                });
                });

            }
            else if (code == (@PHRMS.ViewModels.RegProcessCode.OtpMisMatch)) {
                setTimeout(function () {
                    swal({
                        title: "Oops!",
                        text: "Wrong Verification Code! Please Try registering again.",
                        type: "error"
                    },
                                function () {
                                    window.location = ROOT + 'Account/Register';
                                });
                });
            }
            else {
                setTimeout(function () {
                    swal({
                        title: "Oops!",
                        text: "Something went wrong! Please try registering again.",
                        type: "error"
                    },
                                function () {
                                    window.location = ROOT + 'Account/Register';
                                });
                });

            }
        });

        $("form").submit(function () {
            if ($(this).valid()) {
                $('.splash').fadeIn();
            }
        });
    </script>
}
else
{
    <script>
        $(document).ready(function () {
            $("form").submit(function () {
                if ($(this).valid()) {
                    $('.splash').fadeIn();
                }
            });
        });
    </script>
}